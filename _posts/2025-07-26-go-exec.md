---
layout: post
title: exec.Command ä¸ os.StartProcess æœ‰ä»€ä¹ˆä¸ä¸€æ ·
date: 2025-07-26
categories: Golang
---
exec.Command ä¸ os.StartProcess æœ‰ä»€ä¹ˆä¸ä¸€æ ·

è¿™æ˜¯ä¸€ä¸ªéå¸¸ç»å…¸çš„é—®é¢˜ï¼š**exec.Command å’Œ os.StartProcess éƒ½å¯ä»¥å¯åŠ¨æ–°è¿›ç¨‹ï¼Œä½†åŠŸèƒ½å’Œæ˜“ç”¨æ€§å®Œå…¨ä¸åŒ**ã€‚æˆ‘ç»™ä½ è¯¦ç»†æ‹†è§£ä¸€ä¸‹ï¼š

---

## **1.**

## **os.StartProcess**

### **ç‰¹ç‚¹**

- Go æœ€åº•å±‚çš„ **è¿›ç¨‹åˆ›å»º API**ï¼Œæ˜¯å¯¹ç³»ç»Ÿè°ƒç”¨ fork + execï¼ˆç±» Unixï¼‰æˆ– CreateProcessï¼ˆWindowsï¼‰çš„ç›´æ¥å°è£…ã€‚
- è°ƒç”¨éº»çƒ¦ï¼Œéœ€è¦æ‰‹åŠ¨å‡†å¤‡å‘½ä»¤å‚æ•°ã€ç¯å¢ƒå˜é‡ã€æ ‡å‡†è¾“å…¥è¾“å‡ºã€æ–‡ä»¶æè¿°ç¬¦ç­‰ã€‚
- è¿”å› *os.Processï¼Œåªèƒ½ç”¨å®ƒåšç®€å•çš„è¿›ç¨‹ç®¡ç†ï¼ˆç­‰å¾…ã€æ€æ­»ï¼‰ã€‚

### **ç”¨æ³•ç¤ºä¾‹**

```
package main

import (
	"os"
	"syscall"
)

func main() {
	// argv å¿…é¡»æ˜¯å®Œæ•´è·¯å¾„ + å‚æ•°æ•°ç»„
	procAttr := &os.ProcAttr{
		Dir:   "",
		Env:   os.Environ(),
		Files: []*os.File{os.Stdin, os.Stdout, os.Stderr}, // æŒ‡å®šæ ‡å‡†IO
		Sys:   &syscall.SysProcAttr{},
	}

	process, err := os.StartProcess("/bin/ls", []string{"ls", "-l"}, procAttr)
	if err != nil {
		panic(err)
	}
	process.Wait()
}
```

ğŸ‘‰ ç¼ºç‚¹ï¼šè°ƒç”¨å¤æ‚ï¼Œå‡ ä¹ä¸åšå°è£…ã€‚

---

## **2.**

## **exec.Command**

### **ç‰¹ç‚¹**

- åœ¨ os.StartProcess ä¹‹ä¸Šåšäº† **æ›´é«˜çº§å°è£…**ï¼Œç”¨èµ·æ¥æ›´æ–¹ä¾¿ã€‚
- è‡ªåŠ¨æœç´¢ PATHï¼ˆå¦‚æœå‘½ä»¤ä¸æ˜¯ç»å¯¹è·¯å¾„ï¼‰ã€‚
- æ”¯æŒè®¾ç½® Stdinã€Stdoutã€Stderrï¼Œæ”¯æŒç®¡é“ï¼ˆcmd.StdoutPipeï¼‰ã€‚
- æä¾›äº†å¸¸ç”¨æ–¹æ³•ï¼šRun()ã€Start()ã€Output()ã€CombinedOutput()ã€‚
- é»˜è®¤ä¼šå¤„ç† shell å‚æ•°å’Œç¯å¢ƒå˜é‡ï¼Œåƒå†™è„šæœ¬ä¸€æ ·ç®€å•ã€‚

### **ç”¨æ³•ç¤ºä¾‹**

```
package main

import (
	"fmt"
	"os/exec"
)

func main() {
	// ä¸éœ€è¦å†™ç»å¯¹è·¯å¾„ï¼Œä¼šè‡ªåŠ¨æŸ¥ PATH
	cmd := exec.Command("ls", "-l")

	// ä¸€è¡Œæ‹¿åˆ°è¾“å‡º
	out, err := cmd.Output()
	if err != nil {
		panic(err)
	}
	fmt.Println(string(out))
}
```

ğŸ‘‰ æ¯” os.StartProcess ç®€æ´å¾ˆå¤šã€‚

---

## **3. æ ¸å¿ƒåŒºåˆ«æ€»ç»“**

|**ç‰¹æ€§**|os.StartProcess|exec.Command|
|---|---|---|
|å°è£…ç¨‹åº¦|æœ€åº•å±‚ï¼Œç›´æ¥è°ƒç”¨ç³»ç»Ÿ API|é«˜çº§å°è£…ï¼Œé›†æˆå¸¸ç”¨åŠŸèƒ½|
|å‘½ä»¤è·¯å¾„è§£æ|éœ€è¦ç»å¯¹è·¯å¾„|è‡ªåŠ¨æŒ‰ PATH æŸ¥æ‰¾|
|å‚æ•°ä¼ é€’|å¿…é¡»æ‰‹åŠ¨ç»„è£… argv|ç›´æ¥ä¼ å¯å˜å‚æ•°ï¼Œè‡ªåŠ¨å¤„ç†|
|æ ‡å‡† IO|æ‰‹åŠ¨è®¾ç½® ProcAttr.Files|ç®€å•è®¾ç½® cmd.Stdin/Stdout|
|ç®¡é“æ”¯æŒ|ä¸æ”¯æŒ|æ”¯æŒï¼ˆStdoutPipeã€StderrPipeï¼‰|
|æ–¹æ³•è°ƒç”¨|åªè¿”å› Process|Run()ã€Output() ç­‰æ›´æ–¹ä¾¿|

### **æ€»ç»“ä¸€å¥ï¼š**

- **os.StartProcess**ï¼šä½çº§ã€åŸå§‹ã€å…¨æ‰‹åŠ¨ï¼Œé€‚åˆéœ€è¦ç²¾ç¡®æ§åˆ¶è¿›ç¨‹è¡Œä¸ºï¼ˆæ–‡ä»¶æè¿°ç¬¦ã€æƒé™ï¼‰çš„åœºæ™¯ã€‚
- **exec.Command**ï¼šæ›´é«˜çº§å°è£…ï¼Œæ—¥å¸¸å¤§å¤šæ•°åœºæ™¯éƒ½ç”¨å®ƒï¼Œé™¤éä½ çœŸçš„è¦å®Œå…¨æ§åˆ¶åº•å±‚ã€‚

---

## **4. æºç å…³ç³»**

exec.Command å†…éƒ¨å°±æ˜¯åœ¨ç»„è£…å¥½ argvã€envã€stdin/stdout åï¼Œ**æœ€ç»ˆè°ƒç”¨ os.StartProcess** æ¥å¯åŠ¨è¿›ç¨‹ã€‚

```
// exec.Command (ç®€åŒ–)
func Command(name string, arg ...string) *Cmd {
    return &Cmd{
        Path: name,
        Args: append([]string{name}, arg...),
        // ...
    }
}
```

Cmd.Start() é‡Œæœ€åï¼š

```
p, err := os.StartProcess(cmd.Path, cmd.Args, &os.ProcAttr{...})
```

---
